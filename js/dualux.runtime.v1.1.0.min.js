var g={enableLogging:false,targets:{web:'#web-ux',app:'#app-ux',hiddenClass:'hidden'},mapping:{standaloneTo:'app',fullscreenTo:'app',browserTo:'web'},routes:{appHome:'/app',webHome:'/'},routing:{strategy:'runtime',param:'mode',hashApp:'#/app',hashWeb:'#/web'},storageKey:'dualux'};function x(b,W){return b === undefined?W:b;}function P(U,w = 50){var B;return function(...L){if(B)window.clearTimeout(B);B=window.setTimeout(()=>U.apply(this,L),w);};}function E(n,...V){if(n)console.log('[DUAL-UX]',...V);}function D(){if(document.fullscreenElement)return 'fullscreen';var X=window.matchMedia('(display-mode: standalone)').matches;var Y=window.matchMedia('(display-mode: fullscreen)').matches;var G=window.matchMedia('(display-mode: browser)').matches;var j=window.navigator && window.navigator.standalone === true;var Q=navigator.userAgent || '';var N=(/Android|iPhone|iPad|iPod/i).test(Q);var z=N && typeof (window.navigator || ({})).standalone === 'undefined' && !document.referrer && Math.abs(window.innerHeight - screen.height) <= 1 && window.innerWidth === screen.width;if(X || j || z)return 'standalone';if(Y)return 'fullscreen';if(G)return 'browser';return 'browser';}var s={readIntent(q) {var o=q.routing || ({});var O=o.strategy || 'runtime';if(O === 'query'){var p=o.param || 'mode';var Z=new URLSearchParams(location.search).get(p);if(Z === 'app' || Z === 'web')return Z;return null;}if(O === 'hash'){var R=location.hash || '';if(R.startsWith(o.hashApp || '#/app'))return 'app';if(R.startsWith(o.hashWeb || '#/web'))return 'web';return null;}return null;},navTo(A,k) {var T=k === 'app'?A.routes.appHome:A.routes.webHome;if(T)return T;var f=A.routing || ({});var c=f.strategy || 'runtime';if(c === 'query'){var i=f.param || 'mode';var H=new URL(location.href);H.searchParams.set(i,k);H.hash='';return H.pathname + '?' + H.searchParams.toString();}if(c === 'hash'){var u=k === 'app'?f.hashApp || '#/app':f.hashWeb || '#/web';return location.pathname + location.search + u;}return location.pathname + location.search + (location.hash || '');}};var K=class C{constructor() {this.cfg=JSON.parse(JSON.stringify(g));this.mediaQueries=[];this.handlers=new Set();this.displayMode='browser';this.uxMode='web';this.uxOverride=null;this.isStandalone=false;}configure(I) {if(!I)return;this.cfg.enableLogging=x(I.enableLogging,this.cfg.enableLogging);if(I.targets)this.cfg.targets={...this.cfg.targets,...I.targets};if(I.mapping)this.cfg.mapping={...this.cfg.mapping,...I.mapping};if(I.routes)this.cfg.routes={...this.cfg.routes,...I.routes};if(I.routing)this.cfg.routing={...this.cfg.routing,...I.routing};if(I.storageKey)this.cfg.storageKey=I.storageKey;}init() {this.displayMode=D();this.isStandalone=this.displayMode === 'standalone';var l=s.readIntent(this.cfg);if(l === 'app' || l === 'web')this.uxOverride=l;this.uxMode=this.resolveUxMode();this.persistState();E(this.cfg.enableLogging,'Mode Detected:',{displayMode:this.displayMode,uxMode:this.uxMode,isStandalone:this.isStandalone,routing:this.cfg.routing,userAgent:navigator.userAgent});this.render();this.emit({displayMode:this.displayMode,uxMode:this.uxMode,changed:true,source:l?'url':'detection'});this.mediaQueries=[window.matchMedia('(display-mode: standalone)'),window.matchMedia('(display-mode: fullscreen)'),window.matchMedia('(display-mode: browser)')];var S=P(()=>{var y=D();if(y === this.displayMode)return;var a=this.displayMode;this.displayMode=y;if(y === 'standalone')this.isStandalone=true;if(y === 'browser')this.isStandalone=false;if(!this.uxOverride){if(y === 'fullscreen'){this.uxMode=this.isStandalone?'app':'web';}else {this.uxMode=this.resolveUxMode();}}this.persistState();E(this.cfg.enableLogging,'Display mode changed:',{from:a,to:this.displayMode,uxMode:this.uxMode,isStandalone:this.isStandalone});this.render();this.emit({displayMode:this.displayMode,uxMode:this.uxMode,changed:true,source:'media'});},50);this.mediaQueries.forEach(J=>J.addEventListener('change',S));document.addEventListener('fullscreenchange',()=>{var K7=!!document.fullscreenElement;var r8=K7?'fullscreen':D();if(r8 === this.displayMode)return;this.displayMode=r8;if(!this.uxOverride){if(K7){this.uxMode=this.isStandalone?'app':'web';}else {this.isStandalone=this.displayMode === 'standalone';this.uxMode=this.resolveUxMode();}}this.persistState();E(this.cfg.enableLogging,'Fullscreenchange:',{fullscreen:K7,displayMode:this.displayMode,uxMode:this.uxMode,isStandalone:this.isStandalone});this.render();this.emit({displayMode:this.displayMode,uxMode:this.uxMode,changed:true,source:'fullscreen'});});}getDisplayMode() {return this.displayMode;}getUxMode() {return this.uxMode;}async switchUx(N_,z8) {var M6=z8 || ({});var S2=M6.persist !== false;var D3=!!M6.navigate;var d5=!!M6.requestFullscreen;var q6=this.uxMode;this.uxOverride=N_;this.uxMode=N_;if(S2)this.persistState();if(d5 && N_ === 'app'){try{var n3=document.documentElement;if(n3 && n3.requestFullscreen)await n3.requestFullscreen();}catch(d2){}}if(D3){var K0=s.navTo(this.cfg,N_);var i8=location.pathname + location.search + location.hash;if(i8 !== K0)window.location.assign(K0);}var W$=q6 !== this.uxMode;this.render();var O9={displayMode:this.displayMode,uxMode:this.uxMode,changed:W$,source:'switch'};this.emit(O9);return O9;}on(k1,w4) {this.handlers.add(w4);}off(a0,F2) {this.handlers.delete(F2);}resolveUxMode() {if(this.uxOverride)return this.uxOverride;var u_=this.cfg.mapping;switch(this.displayMode){case 'standalone':return u_.standaloneTo;case 'fullscreen':return this.isStandalone?'app':'web';case 'browser':default:return u_.browserTo;}}render() {var s$=this.cfg.targets;var M1=s$.hiddenClass || 'hidden';var O5=s$.app?document.querySelector(s$.app):null;var V5=s$.web?document.querySelector(s$.web):null;var A1=k7=>k7 && k7.classList.add(M1);var X$=C$=>C$ && C$.classList.remove(M1);var Z$=this.uxMode === 'app';if(Z$){if(O5){X$(O5);if(V5)A1(V5);}else {if(V5)X$(V5);}}else {if(V5){X$(V5);if(O5)A1(O5);}else {if(O5)X$(O5);}}}emit(b$) {this.handlers.forEach(E3=>{try{E3(b$);}catch(F$){console.error('[DUAL-UX] handler error',F$);}});}persistState() {try{var o5=this.cfg.storageKey || 'dualux';localStorage.setItem(`${o5}:displayMode`,this.displayMode);localStorage.setItem(`${o5}:uxMode`,this.uxMode);localStorage.setItem(`${o5}:isStandalone`,String(this.isStandalone));}catch(Z3){}}};var F=new K();export {F as dualux};